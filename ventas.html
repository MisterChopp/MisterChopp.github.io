<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Mister Chopp - Ventas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="fh5co-page">
		<a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
		<aside id="fh5co-aside" role="complementary" class="border js-fullheight">

			<h1><a href="index.html"><img src="images/apple-touch-icon.png" alt="Logo Mister Chopp" style="width: 100%; height: auto;"></a></h1>
		
			<nav id="fh5co-main-menu" role="navigation">
				<ul>					
				    <li><a href="index.html">Inicio</a></li>
                    <li class="fh5co-active"><a href="ventas.html">Registrar venta</a></li>
                    <li><a href="productos.html">Inventario</a></li>
                    <li><a href="dashboard.html">Reportes</a></li>
                    <li><a href="horarios.html">Horario - Empleados</a></li>
                    <li><a href="detalle_reservas.html">Reservas</a></li>
                    <li><a href="login.html">Cerrar Sesión</a></li>
				</ul>
			</nav>

			

		</aside>

        <div id="fh5co-main">
            <div id="content-section" class="fh5co-narrow-content animate-box">
                <h2>Gestión de Ventas</h2>
                <div class="row">
      
                    <!-- Ventas -->
                    <div class="col-md-6">
                        <h3>Ventas</h3>
                        <form id="salesForm">
                            <div class="form-group">
                                <label for="employeeSelect">Empleado:</label>
                                <select id="employeeSelect" class="form-control">
                                    <option value="E01">Jordi Gonzalez</option>
                                    <option value="E02">Andy Fernandez</option>
                                    <option value="E03">Walter Lopez</option>
                                    <option value="E04">Wilfredo Sanchez</option>
                                    <option value="E05">Luis Gomez</option>
                                    <option value="E06">Omaar Diaz</option>
                                    <option value="E07">Max Martinez</option>
                                    <option value="E08">Ricardo Hernandez</option>
                                    <option value="E09">Rodrigo Yrigoyn</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="customerName">Cliente:</label>
                                <input type="text" id="customerName" class="form-control" placeholder="Nombre del cliente" required>
                            </div>
                            <div class="form-group">
                                <label for="drinkSelect">Trago:</label>
                                <select id="drinkSelect" class="form-control">
                                    <option value="Cuba Libre">Cuba Libre - S/12</option>
                                    <option value="Chicano de Pisco">Chilcano de Pisco - S/15</option>
                                    <option value="Perú Libre">Perú Libre - S/14</option>
                                    <option value="Pisco Sour">Pisco Sour - S/18</option>
                                    <option value="Screw Driver">Screw Driver - S/16</option>
                                    <option value="Tequila Sunrise">Tequila Sunrise - S/18</option>
                                    <option value="Piña Colada">Piña Colada - S/20</option>
                                    <option value="Orgasmo">Orgasmo - S/22</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-success" onclick="registerSale()">Registrar Venta</button>
                            </div>
                        </form>
                        
                        

                        <!-- Comprobante de Pago -->
                        <h4>Comprobante de Pago</h4>
                        <div id="receipt" class="border p-3" style="display: none;">
                            <p><strong>N° de Pedido:</strong> <span id="orderNumber"></span></p>
                            <p><strong>Empleado:</strong> <span id="receiptEmployee"></span></p>
                            <p><strong>Cliente:</strong> <span id="receiptCustomer"></span></p>
                            <p><strong>Trago:</strong> <span id="receiptDrink"></span></p>
                            <p><strong>Precio:</strong> S/<span id="receiptPrice"></span></p>
                            <p><strong>Fecha:</strong> <span id="receiptDate"></span></p>
                        </div>
                    </div>                
                 
                </div>
            </div>
        </div>
    </div>
    
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.flexslider-min.js"></script>
    <script src="js/main.js"></script>
    
    <script>
          let orderCounter = localStorage.getItem('orderCounter') ? parseInt(localStorage.getItem('orderCounter')) : 1;


            // Simulación del inventario (equivalente a la tabla Productos)
            let inventory = JSON.parse(localStorage.getItem("inventory")) || [
                { id: 'PR01', name: 'Sprite', stock: 50 },
                { id: 'PR02', name: 'Pisco Nacional Quebranta', stock: 20 },
                { id: 'PR03', name: 'Limón', stock: 100 },
                { id: 'PR04', name: 'Coca Cola', stock: 40 },
                { id: 'PR05', name: 'Clara de huevo', stock: 60 },
                { id: 'PR06', name: 'Agua', stock: 100 },
                { id: 'PR07', name: 'Jarabe de Goma', stock: 30 },
                { id: 'PR08', name: 'Amargo de Angostura', stock: 15 },
                { id: 'PR09', name: 'Jugo de Naranja', stock: 25 },
                { id: 'PR10', name: 'Jarabe de Granadina', stock: 20 },
                { id: 'PR11', name: 'Vodka', stock: 10 },
                { id: 'PR12', name: 'Tequila', stock: 12 },
                { id: 'PR13', name: 'Piña', stock: 30 },
                { id: 'PR14', name: 'Crema de Coco', stock: 15 },
                { id: 'PR15', name: 'Ron Blanco', stock: 10 },
                { id: 'PR16', name: 'Licor de Café', stock: 27 },
                { id: 'PR17', name: 'Bayleys', stock: 15 },
                { id: 'PR18', name: 'Amaretto', stock: 27 },
                { id: 'PR19', name: 'Leche', stock: 50 },
                { id: 'PR20', name: 'Ron', stock: 10 },
                { id: 'PR21', name: 'Cola', stock: 50 },
            ];

            // Guardar el inventario inicial si no existe en LocalStorage
            localStorage.setItem("inventory", JSON.stringify(inventory));

            // Relación entre tragos y productos
            const drinkIngredients = {
                'Cuba Libre': ['PR20', 'PR04', 'PR03'], // Ron, Coca Cola, Limón
                'Chilcano de Pisco': ['PR02', 'PR01', 'PR03'], // Pisco, Sprite, Limón
                'Perú Libre': ['PR02', 'PR04', 'PR03'], // Pisco, Coca Cola, Limón
                'Pisco Sour': ['PR02', 'PR05', 'PR03', 'PR06', 'PR07', 'PR08'], // Pisco, Clara, Limón, Agua, Goma, Amargo
                'Screw Driver': ['PR11', 'PR09', 'PR10'], // Vodka, Jugo de Naranja, Granadina
                'Tequila Sunrise': ['PR12', 'PR09', 'PR10'], // Tequila, Naranja, Granadina
                'Piña Colada': ['PR15', 'PR13', 'PR14', 'PR06'], // Ron Blanco, Piña, Crema Coco, Agua
                'Orgasmo': ['PR16', 'PR17', 'PR18', 'PR19'], // Café, Bayleys, Amaretto, Leche
            };

            // Función para actualizar el inventario
            function updateInventory(drinkName) {
                const ingredients = drinkIngredients[drinkName];
                let updatedInventory = JSON.parse(localStorage.getItem("inventory"));
                let hasStock = true;

                // Validar si hay suficiente stock para todos los ingredientes
                ingredients.forEach((productId) => {
                    let product = updatedInventory.find(item => item.id === productId);
                    if (!product || product.stock <= 0) {
                        hasStock = false;
                        alert(`Producto agotado: ${product ? product.name : productId}`);
                    }
                });

                // Si todos los ingredientes tienen stock, reducirlos
                if (hasStock) {
                    ingredients.forEach((productId) => {
                        let product = updatedInventory.find(item => item.id === productId);
                        if (product) {
                            product.stock--; // Reducir la cantidad
                        }
                    });

                    // Guardar cambios en LocalStorage
                    localStorage.setItem("inventory", JSON.stringify(updatedInventory));
                } else {
                    throw new Error("No hay suficiente stock para completar la venta.");
                }
            }

            function registerSale() {
            const employeeSelect = document.getElementById("employeeSelect");
            const customerName = document.getElementById("customerName").value;
            const drinkSelect = document.getElementById("drinkSelect");

            if (!customerName) {
                alert("Por favor, ingrese el nombre del cliente.");
                return;
            }

            const employee = employeeSelect.options[employeeSelect.selectedIndex].text;
            const drinkInfo = drinkSelect.options[drinkSelect.selectedIndex].text;
            const drinkName = drinkInfo.split(" -")[0];
            const price = parseFloat(drinkInfo.split("S/")[1]);

            try {
                updateInventory(drinkName); // Reducir inventario
                const date = new Date().toLocaleDateString();

                const sale = {
                    orderNumber: orderCounter,
                    employee: employee,
                    customer: customerName,
                    drink: drinkName,
                    price: price, // Agregar precio al objeto venta
                    date: date,
                };

                let sales = JSON.parse(localStorage.getItem("sales")) || [];
                sales.push(sale);
                localStorage.setItem("sales", JSON.stringify(sales));

                // Mostrar comprobante
                document.getElementById("orderNumber").textContent = sale.orderNumber;
                document.getElementById("receiptEmployee").textContent = sale.employee;
                document.getElementById("receiptCustomer").textContent = sale.customer;
                document.getElementById("receiptDrink").textContent = sale.drink;
                document.getElementById("receiptPrice").textContent = sale.price.toFixed(2);
                document.getElementById("receiptDate").textContent = sale.date;
                document.getElementById("receipt").style.display = "block";

                orderCounter++;
                localStorage.setItem('orderCounter', orderCounter);
                document.getElementById("salesForm").reset();
            } catch (error) {
                console.error(error.message);
            }
        }
    </script>
</body>
</html>
